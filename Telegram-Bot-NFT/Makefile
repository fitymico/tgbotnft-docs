# ================== Telegram-Bot-NFT Makefile ==================
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Python –±–æ—Ç–æ–º –∏ TypeScript API

SHELL := /bin/bash
VENV := venv
PYTHON := $(VENV)/bin/python
PIP := $(VENV)/bin/pip

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
PROJECT_DIR := $(shell pwd)
MESSAGE_BOT_DIR := $(PROJECT_DIR)/Message_Bot
GIFT_API_DIR := $(PROJECT_DIR)/Gift_API
SCRIPTS_DIR := $(PROJECT_DIR)/scripts

# PID —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
TALKBOT_PID := $(PROJECT_DIR)/data/talkbot.pid
GIFTBOT_PID := $(PROJECT_DIR)/data/giftbot.pid

.PHONY: help all install install-python install-node venv clean full-clean \
        start start-talkbot start-giftbot \
        stop stop-talkbot stop-giftbot \
        restart status logs \
        docker-build docker-up docker-down docker-logs docker-restart \
        build-bin build-bin-deps release \
        license license-quick license-list license-admin license-public \
        docs docs-build docs-install

# ================== –°–ø—Ä–∞–≤–∫–∞ ==================
help:
	@echo "Telegram-Bot-NFT - Makefile –∫–æ–º–∞–Ω–¥—ã"
	@echo ""
	@echo "–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:"
	@echo "  make all              - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"
	@echo ""
	@echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞:"
	@echo "  make install          - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Python + Node.js)"
	@echo "  make install-python   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo "  make install-node     - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo "  make venv             - –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python"
	@echo ""
	@echo "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏:"
	@echo "  make start            - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã"
	@echo "  make start-talkbot    - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Telegram –±–æ—Ç (aiogram)"
	@echo "  make start-giftbot    - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Gift API –±–æ—Ç"
	@echo ""
	@echo "  make stop             - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã"
	@echo "  make stop-talkbot     - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Telegram –±–æ—Ç"
	@echo "  make stop-giftbot     - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Gift API –±–æ—Ç"
	@echo ""
	@echo "  make restart          - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã"
	@echo "  make status           - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–æ–≤"
	@echo "  make logs             - –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏"
	@echo ""
	@echo "Docker:"
	@echo "  make docker-build     - –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑"
	@echo "  make docker-up        - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker"
	@echo "  make docker-down      - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker"
	@echo "  make docker-logs      - –õ–æ–≥–∏ Docker"
	@echo "  make docker-restart   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker"
	@echo ""
	@echo "–ü—Ä–æ—á–µ–µ:"
	@echo "  make clean            - –£–¥–∞–ª–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∫—ç—à"
	@echo "  make full-clean       - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–ª–æ–≥–∏, node_modules, dist)"
	@echo "  make build-bin        - –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è"
	@echo "  make release          - –°–æ–±—Ä–∞—Ç—å –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–ª–∏–∑ –Ω–∞ GitHub"
	@echo ""
	@echo "–õ–∏—Ü–µ–Ω–∑–∏–∏:"
	@echo "  make license          - –°–æ–∑–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)"
	@echo "  make license-quick    - –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ (DAYS=30 INSTANCES=1 NOTE='')"
	@echo "  make license-list     - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–∏—Ü–µ–Ω–∑–∏–∏"
	@echo "  make license-admin    - –ó–∞–ø—É—Å—Ç–∏—Ç—å admin —Å–µ—Ä–≤–µ—Ä (–ª–æ–∫–∞–ª—å–Ω—ã–π, :8081)"
	@echo "  make license-public   - –ó–∞–ø—É—Å—Ç–∏—Ç—å public —Å–µ—Ä–≤–µ—Ä (–≤–∞–ª–∏–¥–∞—Ü–∏—è, :8080)"
	@echo ""
	@echo "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
	@echo "  make docs             - –ó–∞–ø—É—Å—Ç–∏—Ç—å Docusaurus dev-—Å–µ—Ä–≤–µ—Ä"
	@echo "  make docs-install     - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
	@echo "  make docs-build       - –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo ""
	@echo "–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env (—Å–º. .env.example)"

# ================== –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç ==================
all: install start
	@echo ""
	@echo "üöÄ –ë–æ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω!"

# ================== Docker ==================
DOCKER_DIR := $(PROJECT_DIR)/docker

docker-build:
	@echo "üê≥ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞..."
	docker compose -f $(DOCKER_DIR)/docker-compose.yml build

docker-up: docker-build
	@echo "üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker..."
	docker compose -f $(DOCKER_DIR)/docker-compose.yml up -d
	@echo ""
	@echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ Docker!"
	@echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'make docker-logs' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤"

docker-down:
	@echo "üê≥ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker..."
	docker compose -f $(DOCKER_DIR)/docker-compose.yml down
	@echo "‚úÖ Docker –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

docker-logs:
	docker compose -f $(DOCKER_DIR)/docker-compose.yml logs -f --tail=50

docker-restart: docker-down docker-up
	@echo "‚úÖ Docker –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"

# ================== –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ==================
venv:
	@echo "–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
	@# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ venv –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Python 3
	@if [ -d $(VENV) ]; then \
		if $(PYTHON) --version 2>&1 | grep -q "Python 2"; then \
			echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω Python 2 –≤ venv, –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º..."; \
			rm -rf $(VENV); \
		fi; \
	fi
	@if [ ! -d $(VENV) ]; then \
		python3 -m venv $(VENV); \
		echo "–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –≤ $(VENV)/"; \
	else \
		echo "–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"; \
	fi

install-python: venv
	@echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	$(PIP) install --upgrade pip
	$(PIP) install -r requirements.txt
	@echo "Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"

install-node:
	@echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	cd $(GIFT_API_DIR) && npm install
	@echo "Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"

install: install-python install-node
	@echo ""
	@echo "‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
	@echo ""
	@echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ: make start"

# ================== –ó–∞–ø—É—Å–∫ –±–æ—Ç–æ–≤ ==================
start-talkbot:
	@echo "–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ (talkbot)..."
	@mkdir -p $(PROJECT_DIR)/data
	@if [ -f $(TALKBOT_PID) ] && kill -0 $$(cat $(TALKBOT_PID)) 2>/dev/null; then \
		echo "Telegram –±–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(TALKBOT_PID)))"; \
	else \
		cd $(MESSAGE_BOT_DIR) && \
		source $(PROJECT_DIR)/$(VENV)/bin/activate && \
		set -a && source $(PROJECT_DIR)/.env && set +a && \
		nohup $(PROJECT_DIR)/$(PYTHON) talkbot.py > $(PROJECT_DIR)/data/talkbot.log 2>&1 & \
		echo $$! > $(TALKBOT_PID); \
		echo "Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(TALKBOT_PID)))"; \
	fi

start-giftbot:
	@echo "–ó–∞–ø—É—Å–∫ Gift API –±–æ—Ç–∞..."
	@mkdir -p $(PROJECT_DIR)/data
	@if [ -f $(GIFTBOT_PID) ] && kill -0 $$(cat $(GIFTBOT_PID)) 2>/dev/null; then \
		echo "Gift API –±–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(GIFTBOT_PID)))"; \
	else \
		cd $(GIFT_API_DIR) && \
		set -a && source $(PROJECT_DIR)/.env && set +a && \
		nohup npm run dev > $(PROJECT_DIR)/data/giftbot.log 2>&1 & \
		echo $$! > $(GIFTBOT_PID); \
		echo "Gift API –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(GIFTBOT_PID)))"; \
	fi

start: start-talkbot
	@echo ""
	@echo "‚úÖ –ë–æ—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã!"
	@echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'make logs' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤"
	@echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'make status' –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞"

# ================== –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–æ–≤ ==================
stop-talkbot:
	@echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ Telegram –±–æ—Ç–∞..."
	@if [ -f $(TALKBOT_PID) ]; then \
		PID=$$(cat $(TALKBOT_PID)); \
		if kill -0 $$PID 2>/dev/null; then \
			kill $$PID; \
			sleep 1; \
			if kill -0 $$PID 2>/dev/null; then \
				echo "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."; \
				kill -9 $$PID; \
			fi; \
			echo "Telegram –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"; \
		else \
			echo "Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"; \
		fi; \
		rm -f $(TALKBOT_PID); \
	else \
		echo "Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"; \
	fi

stop-giftbot:
	@echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ Gift API –±–æ—Ç–∞..."
	@if [ -f $(GIFTBOT_PID) ]; then \
		PID=$$(cat $(GIFTBOT_PID)); \
		if kill -0 $$PID 2>/dev/null; then \
			kill $$PID; \
			sleep 1; \
			if kill -0 $$PID 2>/dev/null; then \
				echo "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."; \
				kill -9 $$PID; \
			fi; \
			echo "Gift API –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"; \
		else \
			echo "Gift API –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"; \
		fi; \
		rm -f $(GIFTBOT_PID); \
	else \
		echo "Gift API –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"; \
	fi
	@# –¢–∞–∫–∂–µ —É–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã node –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å
	@pkill -f "node.*giftBot" 2>/dev/null || true

stop: stop-talkbot stop-giftbot
	@# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ—Ü–µ—Å—Å—ã
	@pkill -f "python.*talkbot" 2>/dev/null || true
	@pkill -f "node.*giftBot" 2>/dev/null || true
	@echo ""
	@echo "‚úÖ –í—Å–µ –±–æ—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# ================== –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ==================
restart: stop start
	@echo "‚úÖ –ë–æ—Ç—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã"

# ================== –°—Ç–∞—Ç—É—Å ==================
status:
	@echo "=== –°—Ç–∞—Ç—É—Å –±–æ—Ç–æ–≤ ==="
	@echo ""
	@if [ -f $(TALKBOT_PID) ] && kill -0 $$(cat $(TALKBOT_PID)) 2>/dev/null; then \
		echo "üü¢ Telegram –±–æ—Ç: –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(TALKBOT_PID)))"; \
	else \
		echo "üî¥ Telegram –±–æ—Ç: –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"; \
	fi
	@if [ -f $(GIFTBOT_PID) ] && kill -0 $$(cat $(GIFTBOT_PID)) 2>/dev/null; then \
		echo "üü¢ Gift API –±–æ—Ç: –∑–∞–ø—É—â–µ–Ω (PID: $$(cat $(GIFTBOT_PID)))"; \
	else \
		echo "üî¥ Gift API –±–æ—Ç: –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"; \
	fi
	@echo ""

# ================== –õ–æ–≥–∏ ==================
logs:
	@echo "=== –õ–æ–≥–∏ –±–æ—Ç–æ–≤ ==="
	@echo ""
	@echo "--- Telegram –±–æ—Ç (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫) ---"
	@if [ -f $(PROJECT_DIR)/data/talkbot.log ]; then \
		tail -20 $(PROJECT_DIR)/data/talkbot.log; \
	else \
		echo "–õ–æ–≥ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"; \
	fi
	@echo ""
	@echo "--- Gift API –±–æ—Ç (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫) ---"
	@if [ -f $(PROJECT_DIR)/data/giftbot.log ]; then \
		tail -20 $(PROJECT_DIR)/data/giftbot.log; \
	else \
		echo "–õ–æ–≥ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"; \
	fi
	@echo ""
	@echo "--- –õ–æ–≥ –ø–æ–∫—É–ø–æ–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫) ---"
	@if [ -f $(PROJECT_DIR)/data/bot.log ]; then \
		tail -20 $(PROJECT_DIR)/data/bot.log; \
	else \
		echo "–õ–æ–≥ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"; \
	fi

# ================== –û—á–∏—Å—Ç–∫–∞ ==================
clean:
	@echo "–û—á–∏—Å—Ç–∫–∞..."
	rm -rf $(VENV)
	rm -rf $(MESSAGE_BOT_DIR)/__pycache__
	rm -rf $(PROJECT_DIR)/__pycache__
	find $(PROJECT_DIR) -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find $(PROJECT_DIR) -type f -name "*.pyc" -delete 2>/dev/null || true
	@echo "–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

full-clean: stop clean
	@echo "–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞..."
	@# –£–¥–∞–ª—è–µ–º –ª–æ–≥–∏
	rm -f $(PROJECT_DIR)/data/*.log
	@# –£–¥–∞–ª—è–µ–º PID —Ñ–∞–π–ª—ã
	rm -f $(PROJECT_DIR)/data/*.pid
	@# –£–¥–∞–ª—è–µ–º node_modules –∏ dist
	rm -rf $(GIFT_API_DIR)/node_modules
	rm -rf $(GIFT_API_DIR)/dist
	@echo ""
	@echo "‚úÖ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
	@echo "–î–ª—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: make install"

# ================== –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ ==================
VERSION := $(shell cat .version 2>/dev/null || echo "0.0.0")
RELEASE_DIR := $(PROJECT_DIR)/../releases/v$(VERSION)

build-bin-deps:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Å–±–æ—Ä–∫–∏..."
	$(PIP) install pyinstaller
	@if ! command -v bun &> /dev/null; then \
		echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ bun..."; \
		curl -fsSL https://bun.sh/install | bash; \
	fi

build-bin: install build-bin-deps
	@echo ""
	@echo "üì¶ –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ v$(VERSION)..."
	@echo ""
	@# –°–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
	mkdir -p $(RELEASE_DIR)/linux/data
	mkdir -p $(RELEASE_DIR)/macos/data
	mkdir -p $(RELEASE_DIR)/windows/data
	@# –ö–æ–ø–∏—Ä—É–µ–º .env.example
	cp $(PROJECT_DIR)/.env.example $(RELEASE_DIR)/linux/
	cp $(PROJECT_DIR)/.env.example $(RELEASE_DIR)/macos/
	cp $(PROJECT_DIR)/.env.example $(RELEASE_DIR)/windows/
	@# –ö–æ–ø–∏—Ä—É–µ–º LICENSE
	cp $(PROJECT_DIR)/LICENSE $(RELEASE_DIR)/linux/
	cp $(PROJECT_DIR)/LICENSE $(RELEASE_DIR)/macos/
	cp $(PROJECT_DIR)/LICENSE $(RELEASE_DIR)/windows/
	cp $(PROJECT_DIR)/LICENSE.ru $(RELEASE_DIR)/linux/
	cp $(PROJECT_DIR)/LICENSE.ru $(RELEASE_DIR)/macos/
	cp $(PROJECT_DIR)/LICENSE.ru $(RELEASE_DIR)/windows/
	@# –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω status.json
	echo '{"is_running":false,"status_text":"–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω","distribution":"<1000 10","iterations_total":100,"iteration_current":0,"delay":1000}' > $(RELEASE_DIR)/linux/data/status.json
	echo '{"is_running":false,"status_text":"–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω","distribution":"<1000 10","iterations_total":100,"iteration_current":0,"delay":1000}' > $(RELEASE_DIR)/macos/data/status.json
	echo '{"is_running":false,"status_text":"–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω","distribution":"<1000 10","iterations_total":100,"iteration_current":0,"delay":1000}' > $(RELEASE_DIR)/windows/data/status.json
	@# –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π giftID.json
	echo '[]' > $(RELEASE_DIR)/linux/data/giftID.json
	echo '[]' > $(RELEASE_DIR)/macos/data/giftID.json
	echo '[]' > $(RELEASE_DIR)/windows/data/giftID.json
	@echo ""
	@echo "üêç –°–±–æ—Ä–∫–∞ Python –±–æ—Ç–∞..."
	cd $(MESSAGE_BOT_DIR) && \
		$(PROJECT_DIR)/$(PYTHON) -m PyInstaller --onefile --clean \
		--name talkbot \
		--distpath $(RELEASE_DIR)/linux \
		--add-data "../config.py:." \
		talkbot.py
	@echo ""
	@echo "üü¢ –°–±–æ—Ä–∫–∞ Node.js –±–æ—Ç–∞ —Å Bun..."
	@# –°–±–æ—Ä–∫–∞ –¥–ª—è Linux
	cd $(GIFT_API_DIR) && bun build src/giftBot.ts --compile --target=bun-linux-x64 --outfile $(RELEASE_DIR)/linux/giftBot
	@# –°–±–æ—Ä–∫–∞ –¥–ª—è macOS
	cd $(GIFT_API_DIR) && bun build src/giftBot.ts --compile --target=bun-darwin-x64 --outfile $(RELEASE_DIR)/macos/giftBot-x64
	cd $(GIFT_API_DIR) && bun build src/giftBot.ts --compile --target=bun-darwin-arm64 --outfile $(RELEASE_DIR)/macos/giftBot-arm64
	@# –°–±–æ—Ä–∫–∞ –¥–ª—è Windows
	cd $(GIFT_API_DIR) && bun build src/giftBot.ts --compile --target=bun-windows-x64 --outfile $(RELEASE_DIR)/windows/giftBot.exe
	@# –ö–æ–ø–∏—Ä—É–µ–º –≤ latest
	@echo ""
	@echo "üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ releases/latest..."
	rm -rf $(PROJECT_DIR)/../releases/latest
	cp -r $(RELEASE_DIR) $(PROJECT_DIR)/../releases/latest
	@echo ""
	@echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
	@echo "–†–µ–ª–∏–∑—ã –≤: $(RELEASE_DIR)/"
	@echo "Latest:   $(PROJECT_DIR)/../releases/latest/"
	@echo ""
	@ls -la $(RELEASE_DIR)/

# –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–ª–∏–∑–∞ –Ω–∞ GitHub
release: build-bin
	@echo ""
	@echo "üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–ª–∏–∑–∞ v$(VERSION) –Ω–∞ GitHub..."
	@echo ""
	@# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ gh CLI
	@if ! command -v gh &> /dev/null; then \
		echo "‚ùå –û—à–∏–±–∫–∞: gh CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: brew install gh"; \
		exit 1; \
	fi
	@# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
	@if ! gh auth status &> /dev/null; then \
		echo "‚ùå –û—à–∏–±–∫–∞: gh –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: gh auth login"; \
		exit 1; \
	fi
	@# –°–æ–∑–¥–∞—ë–º zip-–∞—Ä—Ö–∏–≤
	@echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞..."
	cd $(PROJECT_DIR)/../releases && zip -r v$(VERSION).zip v$(VERSION)/
	cd $(PROJECT_DIR)/../releases && cp v$(VERSION).zip latest.zip
	@# –°–æ–∑–¥–∞—ë–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–ª–∏–∑
	cd $(PROJECT_DIR)/../releases && gh release create v$(VERSION) \
		--repo pluttan/Telegram-bot-NFT-releases \
		--title "Release v$(VERSION)" \
		--notes "Telegram Gift Bot v$(VERSION)" \
		v$(VERSION).zip
	@# –û–±–Ω–æ–≤–ª—è–µ–º latest —Ä–µ–ª–∏–∑ (—É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –µ—Å–ª–∏ –µ—Å—Ç—å, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π)
	@echo ""
	@echo "üì§ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ latest..."
	-gh release delete latest --repo pluttan/Telegram-bot-NFT-releases --yes 2>/dev/null || true
	-git -C $(PROJECT_DIR)/../releases push origin :refs/tags/latest 2>/dev/null || true
	cd $(PROJECT_DIR)/../releases && gh release create latest \
		--repo pluttan/Telegram-bot-NFT-releases \
		--title "Latest Release (v$(VERSION))" \
		--notes "–ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è Telegram Gift Bot (v$(VERSION))" \
		--prerelease \
		latest.zip
	@echo ""
	@echo "‚úÖ –†–µ–ª–∏–∑—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã!"
	@echo "v$(VERSION): https://github.com/pluttan/Telegram-bot-NFT-releases/releases/tag/v$(VERSION)"
	@echo "latest:     https://github.com/pluttan/Telegram-bot-NFT-releases/releases/tag/latest"

# ================== –õ–∏—Ü–µ–Ω–∑–∏–∏ ==================
LICENSE_DIR := $(PROJECT_DIR)/licenses/server
LICENSE_DB := $(LICENSE_DIR)/licenses.db

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
license:
	@cd $(LICENSE_DIR) && python3 create_license.py create

# –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
license-quick:
	@cd $(LICENSE_DIR) && python3 create_license.py create-quick --days $(or $(DAYS),30) --instances $(or $(INSTANCES),1) --note "$(or $(NOTE),)"

# –°–ø–∏—Å–æ–∫ –ª–∏—Ü–µ–Ω–∑–∏–π
license-list:
	@cd $(LICENSE_DIR) && python3 create_license.py list

# Admin —Å–µ—Ä–≤–µ—Ä (–¢–û–õ–¨–ö–û –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏!)
license-admin:
	@echo ""
	@echo "‚ö†Ô∏è  ADMIN SERVER - –¢–û–õ–¨–ö–û –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–û–ô –°–ï–¢–ò!"
	@echo "–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://127.0.0.1:8081"
	@echo ""
	cd $(LICENSE_DIR) && pip install -q -r requirements.txt && python3 admin_server.py

# Public —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–π –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ)
license-public:
	@echo ""
	@echo "üåê PUBLIC SERVER - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–π"
	@echo "API: http://0.0.0.0:8080"
	@echo ""
	cd $(LICENSE_DIR) && pip install -q -r requirements.txt && python3 public_server.py

# ================== –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ==================
DOCS_DIR := $(PROJECT_DIR)/docs

docs-install:
	@echo "üìö –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
	cd $(DOCS_DIR) && npm install
	@echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"

docs: docs-install
	@echo ""
	@echo "üìö –ó–∞–ø—É—Å–∫ Docusaurus dev-—Å–µ—Ä–≤–µ—Ä–∞..."
	@echo "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:3000"
	@echo ""
	cd $(DOCS_DIR) && npm start

docs-build: docs-install
	@echo ""
	@echo "üìö –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
	cd $(DOCS_DIR) && npm run build
	@echo ""
	@echo "‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞ –≤ $(DOCS_DIR)/build/"
